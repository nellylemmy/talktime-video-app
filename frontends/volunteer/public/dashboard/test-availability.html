<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkTime - Test Student Availability</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Test Student Availability</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Date Selection</h2>
            <div class="flex flex-col md:flex-row gap-4 items-end">
                <div class="w-full md:w-1/3">
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Select Date</label>
                    <input type="date" id="date" name="date" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button id="check-availability" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Check Availability
                </button>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Available Students -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-green-600">Available Students</h2>
                <div id="available-students" class="space-y-4">
                    <p class="text-gray-500 italic">Select a date to see available students</p>
                </div>
            </div>
            
            <!-- Unavailable Students -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-red-600">Unavailable Students</h2>
                <div id="unavailable-students" class="space-y-4">
                    <p class="text-gray-500 italic">Select a date to see unavailable students</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('date');
            const checkButton = document.getElementById('check-availability');
            const availableStudentsContainer = document.getElementById('available-students');
            const unavailableStudentsContainer = document.getElementById('unavailable-students');
            
            // Set default date to today
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            dateInput.value = formattedDate;
            
            checkButton.addEventListener('click', async function() {
                const selectedDate = dateInput.value;
                if (!selectedDate) {
                    alert('Please select a date');
                    return;
                }
                
                try {
                    // Show loading state
                    availableStudentsContainer.innerHTML = '<p class="text-gray-500">Loading available students...</p>';
                    unavailableStudentsContainer.innerHTML = '<p class="text-gray-500">Loading unavailable students...</p>';
                    
                    // Fetch available students
                    const availableResponse = await fetch(`/api/v1/volunteers/students/cards?date=${selectedDate}&status=available`);
                    const availableData = await availableResponse.json();
                    
                    // Fetch unavailable students
                    const unavailableResponse = await fetch(`/api/v1/volunteers/students/cards?date=${selectedDate}&status=unavailable`);
                    const unavailableData = await unavailableResponse.json();
                    
                    // Render available students
                    if (availableData.length === 0) {
                        availableStudentsContainer.innerHTML = '<p class="text-gray-500 italic">No available students found for this date</p>';
                    } else {
                        availableStudentsContainer.innerHTML = availableData.map(student => `
                            <div class="border border-gray-200 rounded-md p-4 hover:bg-gray-50">
                                <h3 class="font-medium">${student.full_name}</h3>
                                <p class="text-sm text-gray-500">ID: ${student.id}</p>
                                <p class="text-sm text-gray-500">Admission #: ${student.admission_number}</p>
                            </div>
                        `).join('');
                    }
                    
                    // Render unavailable students
                    if (unavailableData.length === 0) {
                        unavailableStudentsContainer.innerHTML = '<p class="text-gray-500 italic">No unavailable students found for this date</p>';
                    } else {
                        unavailableStudentsContainer.innerHTML = unavailableData.map(student => `
                            <div class="border border-gray-200 rounded-md p-4 hover:bg-gray-50">
                                <h3 class="font-medium">${student.full_name}</h3>
                                <p class="text-sm text-gray-500">ID: ${student.id}</p>
                                <p class="text-sm text-gray-500">Admission #: ${student.admission_number}</p>
                                <p class="text-sm text-green-600 mt-2">Meeting Time: ${new Date(student.meeting_time).toLocaleTimeString()}</p>
                            </div>
                        `).join('');
                    }
                    
                    console.log(`Checked availability for date: ${selectedDate}`);
                    console.log(`Available students: ${availableData.length}`);
                    console.log(`Unavailable students: ${unavailableData.length}`);
                    
                } catch (error) {
                    console.error('Error fetching student availability:', error);
                    availableStudentsContainer.innerHTML = '<p class="text-red-500">Error loading available students</p>';
                    unavailableStudentsContainer.innerHTML = '<p class="text-red-500">Error loading unavailable students</p>';
                }
            });
            
            // Trigger initial check
            checkButton.click();
        });
    </script>
</body>
</html>
