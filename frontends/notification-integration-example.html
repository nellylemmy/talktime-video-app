<!-- 
TalkTime Volunteer Frontend - Notification Integration Example
This shows how to integrate the universal notification system into the volunteer interface
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkTime Volunteer - Enhanced with Notifications</title>
    
    <!-- CRITICAL: Include notification loader FIRST -->
    <!-- This must be in the <head> of EVERY page -->
    <script>
        // Inline the notification loader for fastest loading
        // This ensures notifications work immediately on page load
    </script>
    <script src="/shared/notification-loader.html"></script>
    
    <!-- Regular page styles -->
    <style>
        .notification-demo {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .demo-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        .demo-button:hover {
            background: #3182ce;
        }
        
        .status-indicator {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .status-granted {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-denied {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .status-default {
            background: #fef5e7;
            color: #744210;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî TalkTime Volunteer Dashboard - Notification Enhanced</h1>
        
        <div class="notification-demo">
            <h3>üì± Notification System Status</h3>
            <div id="notification-status">
                <div class="status-indicator status-default">
                    üîÑ Checking notification system...
                </div>
            </div>
            
            <div id="notification-controls" style="display: none;">
                <button class="demo-button" onclick="testNotification()">
                    üß™ Send Test Notification
                </button>
                <button class="demo-button" onclick="testMeetingReminder()">
                    ‚è∞ Test Meeting Reminder
                </button>
                <button class="demo-button" onclick="testInstantCall()">
                    üìû Test Instant Call
                </button>
                <button class="demo-button" onclick="testSystemAlert()">
                    üö® Test System Alert
                </button>
                <button class="demo-button" onclick="requestPermissionAgain()">
                    üîê Show Permission Modal
                </button>
            </div>
        </div>
        
        <div class="notification-demo">
            <h3>üéØ Real TalkTime Features</h3>
            <p>These buttons simulate real TalkTime events that trigger notifications:</p>
            
            <button class="demo-button" onclick="simulateNewStudentRequest()">
                üë§ New Student Request
            </button>
            <button class="demo-button" onclick="simulateMeetingStarting()">
                üé• Meeting Starting Soon
            </button>
            <button class="demo-button" onclick="simulateInstantCallRequest()">
                üìû Incoming Call Request
            </button>
            <button class="demo-button" onclick="simulateConnectionRequest()">
                ü§ù New Connection Request
            </button>
        </div>
        
        <div class="notification-demo">
            <h3>üìä Notification Analytics</h3>
            <div id="notification-analytics">
                <p>Analytics will be displayed here once notification interactions occur.</p>
            </div>
        </div>
    </div>

    <script>
        // Wait for notification system to be ready
        let notificationSystemReady = false;
        
        // Listen for notification system ready event
        document.addEventListener('talktimeNotificationSystemReady', function(event) {
            console.log('üéâ Notification system is ready!', event.detail);
            notificationSystemReady = true;
            updateNotificationStatus();
            setupNotificationListeners();
        });
        
        // Listen for notification enforcer ready event
        document.addEventListener('talktimeNotificationReady', function(event) {
            console.log('üîî Notification enforcer ready!', event.detail);
            updateNotificationStatus();
        });
        
        // Check notification status periodically
        function updateNotificationStatus() {
            const statusDiv = document.getElementById('notification-status');
            const controlsDiv = document.getElementById('notification-controls');
            
            if (window.TalkTimeNotifications && window.TalkTimeNotifications.isReady()) {
                const permission = window.TalkTimeNotifications.getPermissionStatus();
                
                let statusHtml = '';
                let statusClass = '';
                
                switch (permission) {
                    case 'granted':
                        statusHtml = '‚úÖ Notifications Enabled - Full functionality active!';
                        statusClass = 'status-granted';
                        controlsDiv.style.display = 'block';
                        break;
                    case 'denied':
                        statusHtml = '‚ùå Notifications Blocked - Limited functionality';
                        statusClass = 'status-denied';
                        controlsDiv.style.display = 'block';
                        break;
                    case 'default':
                        statusHtml = '‚ùì Notification permission not set';
                        statusClass = 'status-default';
                        controlsDiv.style.display = 'block';
                        break;
                    case 'unsupported':
                        statusHtml = 'üö´ Browser does not support notifications';
                        statusClass = 'status-denied';
                        break;
                    default:
                        statusHtml = 'üîÑ Notification system loading...';
                        statusClass = 'status-default';
                }
                
                statusDiv.innerHTML = `<div class="status-indicator ${statusClass}">${statusHtml}</div>`;
            }
        }
        
        // Setup notification event listeners
        function setupNotificationListeners() {
            // Listen for notification clicks
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.addEventListener('message', function(event) {
                    console.log('üì® Message from service worker:', event.data);
                    
                    if (event.data.type === 'notification_clicked') {
                        updateAnalytics('Notification clicked: ' + event.data.tag);
                    }
                });
            }
        }
        
        // Test Functions
        function testNotification() {
            if (window.TalkTimeNotifications) {
                window.TalkTimeNotifications.sendTestNotification(
                    'üß™ TalkTime Test',
                    'This is a test notification from the volunteer dashboard!'
                );
                updateAnalytics('Test notification sent');
            }
        }
        
        function testMeetingReminder() {
            if (Notification.permission === 'granted') {
                new Notification('‚è∞ Meeting Starting Soon', {
                    body: 'Your conversation with Sarah starts in 5 minutes. Click to join!',
                    icon: '/favicon.ico',
                    tag: 'meeting-reminder-test',
                    requireInteraction: true,
                    actions: [
                        { action: 'join', title: 'üé• Join Now', icon: '/favicon.ico' },
                        { action: 'remind_later', title: '‚è∞ Remind in 5 min', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'meeting_reminder',
                        meeting_id: 'test-123',
                        student_name: 'Sarah'
                    }
                });
                updateAnalytics('Meeting reminder test sent');
            }
        }
        
        function testInstantCall() {
            if (Notification.permission === 'granted') {
                new Notification('üìû Incoming Call', {
                    body: 'Ahmed is requesting an instant conversation. Accept or decline?',
                    icon: '/favicon.ico',
                    tag: 'instant-call-test',
                    requireInteraction: true,
                    actions: [
                        { action: 'accept', title: '‚úÖ Accept', icon: '/favicon.ico' },
                        { action: 'decline', title: '‚ùå Decline', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'instant_call',
                        call_id: 'call-456',
                        student_name: 'Ahmed'
                    }
                });
                updateAnalytics('Instant call test sent');
            }
        }
        
        function testSystemAlert() {
            if (Notification.permission === 'granted') {
                new Notification('üö® System Alert', {
                    body: 'Your profile verification has been completed successfully!',
                    icon: '/favicon.ico',
                    tag: 'system-alert-test',
                    requireInteraction: false,
                    actions: [
                        { action: 'view_profile', title: 'üë§ View Profile', icon: '/favicon.ico' },
                        { action: 'dismiss', title: '‚úï Dismiss', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'system_alert',
                        alert_type: 'profile_verified'
                    }
                });
                updateAnalytics('System alert test sent');
            }
        }
        
        function requestPermissionAgain() {
            if (window.TalkTimeNotifications) {
                window.TalkTimeNotifications.requestPermission();
                updateAnalytics('Permission modal requested');
            }
        }
        
        // Simulate real TalkTime events
        function simulateNewStudentRequest() {
            // This would normally come from the backend via Socket.IO
            if (Notification.permission === 'granted') {
                new Notification('üë§ New Student Request', {
                    body: 'Maria from Spain wants to practice English conversation. Review her request?',
                    icon: '/favicon.ico',
                    tag: 'student-request-' + Date.now(),
                    requireInteraction: true,
                    actions: [
                        { action: 'view_profile', title: 'üëÄ View Profile', icon: '/favicon.ico' },
                        { action: 'schedule_meeting', title: 'üìÖ Schedule', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'student_request',
                        student_id: 'student-789',
                        student_name: 'Maria',
                        url: '/volunteer/dashboard/students.html'
                    }
                });
                updateAnalytics('Simulated: New student request');
            }
        }
        
        function simulateMeetingStarting() {
            if (Notification.permission === 'granted') {
                new Notification('üé• Meeting Starting Now', {
                    body: 'Your conversation with David is ready to begin!',
                    icon: '/favicon.ico',
                    tag: 'meeting-starting-' + Date.now(),
                    requireInteraction: true,
                    actions: [
                        { action: 'join', title: 'üöÄ Join Meeting', icon: '/favicon.ico' },
                        { action: 'reschedule', title: 'üìÖ Reschedule', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'meeting_starting',
                        meeting_id: 'meeting-101',
                        student_name: 'David',
                        meeting_url: '/call/meeting-101'
                    }
                });
                updateAnalytics('Simulated: Meeting starting notification');
            }
        }
        
        function simulateInstantCallRequest() {
            if (Notification.permission === 'granted') {
                new Notification('üìû Instant Call Request', {
                    body: 'Li Wei is looking for immediate conversation practice. Available now?',
                    icon: '/favicon.ico',
                    tag: 'instant-call-' + Date.now(),
                    requireInteraction: true,
                    actions: [
                        { action: 'accept', title: '‚úÖ Accept Call', icon: '/favicon.ico' },
                        { action: 'decline', title: '‚ùå Not Available', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'instant_call_request',
                        call_id: 'instant-202',
                        student_name: 'Li Wei',
                        call_url: '/call/instant-202'
                    }
                });
                updateAnalytics('Simulated: Instant call request');
            }
        }
        
        function simulateConnectionRequest() {
            if (Notification.permission === 'granted') {
                new Notification('ü§ù New Connection Request', {
                    body: 'Ana wants to connect with you for regular conversation practice.',
                    icon: '/favicon.ico',
                    tag: 'connection-' + Date.now(),
                    requireInteraction: false,
                    actions: [
                        { action: 'approve', title: '‚úÖ Approve', icon: '/favicon.ico' },
                        { action: 'view_profile', title: 'üë§ View Profile', icon: '/favicon.ico' }
                    ],
                    data: {
                        type: 'connection_request',
                        request_id: 'conn-303',
                        student_name: 'Ana',
                        student_id: 'student-303'
                    }
                });
                updateAnalytics('Simulated: Connection request');
            }
        }
        
        // Analytics function
        function updateAnalytics(message) {
            const analyticsDiv = document.getElementById('notification-analytics');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `<div>[${timestamp}] ${message}</div>`;
            analyticsDiv.innerHTML = logEntry + analyticsDiv.innerHTML;
        }
        
        // Initialize status check
        setTimeout(updateNotificationStatus, 1000);
        setInterval(updateNotificationStatus, 5000);
        
        console.log('üîî TalkTime Volunteer Frontend - Notification Integration Ready');
    </script>
</body>
</html>
