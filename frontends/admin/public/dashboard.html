<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkTime Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="/shared/js/jwt-auth-utils.js"></script>
    <!-- Modal Utilities -->
    <script src="/volunteer/js/modal-utils.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .btn-primary {
            background: linear-gradient(to right, #f56565, #ed8936);
        }
        .btn-secondary {
            background-color: #4CAF50;
        }
        .btn-danger {
            background-color: #EF4444;
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        #main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        #profile-dropdown.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        body { 
            padding-top: 120px; 
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header Navigation (same as other pages) -->
    <header id="main-header" class="fixed top-0 left-0 right-0 p-6 z-20">
        <nav class="container mx-auto flex items-center justify-between relative">
            <div class="flex flex-col">
                <a href="/" class="flex items-center text-2xl font-bold" aria-label="TalkTime Home">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2" viewBox="0 0 24 24" fill="none">
                        <defs><linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#4f46e5;"></stop><stop offset="100%" style="stop-color:#a855f7;"></stop></linearGradient></defs>
                        <path stroke="url(#logo-gradient)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2z"></path>
                    </svg>
                    <span class="gradient-text">TALK TIME</span>
                </a>
                <div class="flex items-center gap-2 mt-0.5">
                    <img src="https://adeafoundation.org/wp-content/uploads/2018/02/ADEA_Logo_rev.jpg" alt="ADEA Foundation" class="w-7 h-7 rounded-full object-cover border border-gray-200">
                    <a href="https://adeafoundation.org" target="_blank" rel="noopener" class="text-sm leading-none text-gray-600 hover:text-indigo-600 transition-colors">
                        Powered by ADEA Foundation
                    </a>
                </div>
            </div>
          
            <!-- Desktop Navigation Menu -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="/" class="px-4 py-2 text-gray-700 hover:text-green-600 transition-colors font-medium">
                    <i class="fas fa-home mr-2"></i>Home
                </a>
                <a href="/admin/who-we-are.html" class="px-4 py-2 text-gray-700 hover:text-purple-600 transition-colors font-medium">
                    <i class="fas fa-heart mr-2"></i>Who We Are
                </a>
                <a href="/admin/dashboard" class="px-4 py-2 text-gray-700 hover:text-blue-600 transition-colors font-medium">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </a>
            </div>
            
            <!-- Profile Section -->
            <div id="nav-profile-section" class="flex items-center space-x-4">
                <!-- Notification Bell -->
                <div class="relative">
                    <a href="/admin/notifications" class="relative p-2 text-gray-600 hover:text-blue-600 transition-colors duration-200 rounded-lg hover:bg-gray-100">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <!-- Bell body -->
                            <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            
                            <!-- Bell clapper -->
                            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span id="notification-badge" class="absolute -top-1 -right-1 hidden bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold shadow-lg"></span>
                    </a>
                </div>
                <div class="relative">
                    <button id="profile-btn" class="flex items-center gap-2 focus:outline-none">
                        <span id="admin-greeting" class="font-semibold sm:inline">Welcome, Admin!</span>
                        <div class="relative">
                            <img id="nav-profile-image" src="" alt="Profile" class="w-10 h-10 rounded-full object-cover border-2 border-gray-200 hidden">
                            <div id="admin-initial" class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">A</div>
                        </div>
                        <svg class="w-4 h-4 text-gray-600 hidden sm:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div id="profile-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 transform transition-all duration-200 ease-in-out z-[9999] hidden opacity-0 -translate-y-2">
                        <a href="/admin/analytics" class="block px-4 py-2 text-gray-800 hover:bg-purple-50 hover:text-purple-600 rounded mx-2 my-1 transition-colors">
                            <i class="fas fa-chart-bar mr-2"></i>Analytics
                        </a>
                        <a href="/admin/settings" class="block px-4 py-2 text-gray-800 hover:bg-indigo-50 hover:text-indigo-600 rounded mx-2 my-1 transition-colors">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </a>
                        <hr class="my-2 border-gray-200">
                        <a href="#" id="logout-link" class="block px-4 py-2 text-gray-800 hover:bg-red-50 hover:text-red-600 rounded mx-2 my-1 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
          
            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button id="mobile-menu-toggle" class="text-gray-800" aria-label="Toggle menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
          
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="absolute top-full left-0 w-full bg-white shadow-md rounded-b-lg hidden flex-col p-4 space-y-2 md:hidden z-50">
                <a href="/" class="block py-2 px-4 text-gray-800 hover:text-green-600">
                    <i class="fas fa-home mr-2"></i>Home
                </a>
                <a href="/admin/who-we-are.html" class="block py-2 px-4 text-gray-800 hover:text-purple-600">
                    <i class="fas fa-heart mr-2"></i>Who We Are
                </a>
                <a href="/admin/dashboard" class="block py-2 px-4 text-gray-800 hover:text-blue-600">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </a>
                <a href="/admin/notifications" class="block py-2 px-4 text-gray-800 hover:text-blue-600 font-semibold">
                    <i class="fas fa-bell mr-2"></i>Notifications
                </a>
                <a href="/admin/settings" class="block py-2 px-4 text-gray-800 hover:text-indigo-600 font-semibold">
                    <i class="fas fa-cog mr-2"></i>Settings
                </a>
                <a href="#" id="mobile-logout-btn" class="block py-2 px-4 text-gray-800 hover:text-red-600">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
            </div>
        </nav>
    </header>

    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="border-b border-gray-200 pb-5 mb-5">
                <h1 class="text-2xl font-bold text-gray-900">Admin Dashboard</h1>
                <p class="mt-2 text-sm text-gray-500">Manage students, view meetings, and oversee the TalkTime platform.</p>
            </div>
            
            <!-- Dashboard Navigation Tabs -->
            <div class="mb-6">
                <nav class="flex space-x-8" aria-label="Tabs">
                    <button id="students-tab" class="tab-button active border-b-2 border-pink-500 py-2 px-1 text-sm font-medium text-pink-600" onclick="switchTab('students')">
                        <i class="fas fa-users mr-2"></i>Students
                    </button>
                    <button id="meetings-tab" class="tab-button border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300" onclick="switchTab('meetings')">
                        <i class="fas fa-calendar-alt mr-2"></i>Meetings
                    </button>
                </nav>
            </div>

            <!-- Students Tab Content -->
            <div id="students-content" class="tab-content">
                <div class="border-b border-gray-200 pb-3 mb-5">
                    <h2 class="text-xl font-semibold text-gray-900">Student Management</h2>
                    <p class="mt-1 text-sm text-gray-500">Create, view, edit, and delete student records.</p>
                </div>
                <div class="flex flex-col md:flex-row gap-6">
                <!-- Student Creation Form -->
                <div class="w-full md:w-1/3 bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Add New Student</h2>
                    <form id="add-student-form" class="space-y-4">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="w-full md:w-1/2">
                                <label for="firstName" class="block text-sm font-medium text-gray-700">First Name *</label>
                                <input type="text" id="firstName" name="firstName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                            </div>
                            <div class="w-full md:w-1/2">
                                <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name *</label>
                                <input type="text" id="lastName" name="lastName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                            </div>
                        </div>
                        <div>
                            <label for="admissionNumber" class="block text-sm font-medium text-gray-700">Admission Number *</label>
                            <div class="flex">
                                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">ADM</span>
                                <input type="text" id="admissionNumber" name="admissionNumber" required placeholder="0000" maxlength="4" pattern="\d{4}" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-r-md border border-gray-300 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                            </div>
                            <p class="mt-1 text-xs text-gray-500">Enter exactly 4 digits (e.g., 0002)</p>
                        </div>
                        <div>
                            <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                            <input type="number" id="age" name="age" min="1" max="100" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                            <select id="gender" name="gender" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="bio" class="block text-sm font-medium text-gray-700">Bio</label>
                            <textarea id="bio" name="bio" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm"></textarea>
                            <p class="mt-1 text-xs text-gray-500">Brief description of the student (1-2 sentences)</p>
                        </div>
                        <div>
                            <label for="story" class="block text-sm font-medium text-gray-700">Student Story</label>
                            <textarea id="story" name="story" rows="5" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm"></textarea>
                            <p class="mt-1 text-xs text-gray-500">Detailed background story about the student</p>
                        </div>
                        <div>
                            <label for="profileImage" class="block text-sm font-medium text-gray-700">Profile Picture URL</label>
                            <input type="url" id="profileImage" name="profileImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="https://example.com/image.jpg">
                            <p class="mt-1 text-xs text-gray-500">Direct link to student's profile picture</p>
                        </div>
                        <div>
                            <label for="gallery" class="block text-sm font-medium text-gray-700">Gallery URLs</label>
                            <textarea id="gallery" name="gallery" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="https://example.com/image1.jpg\nhttps://example.com/image2.jpg"></textarea>
                            <p class="mt-1 text-xs text-gray-500">Enter one image URL per line</p>
                        </div>
                        <div>
                            <button type="submit" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white btn-primary hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                                Create Student
                            </button>
                        </div>
                    </form>
                    <div id="form-message" class="mt-4 text-sm hidden"></div>
                </div>

                <!-- Student List -->
                <div class="w-full md:w-2/3 bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-medium text-gray-900">Student List</h2>
                        <div class="flex space-x-2">
                            <button id="refresh-students" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <i class="fas fa-sync-alt mr-1"></i> Refresh
                            </button>
                            <button id="delete-all-students" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                <i class="fas fa-trash-alt mr-1"></i> Delete All
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Admission #</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Age</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gender</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="student-list" class="bg-white divide-y divide-gray-200">
                                <!-- Student rows will be inserted here -->
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                                        Loading students...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>
            
            <!-- Meetings Tab Content -->
            <div id="meetings-content" class="tab-content hidden">
                <div class="border-b border-gray-200 pb-3 mb-5">
                    <h2 class="text-xl font-semibold text-gray-900">Meeting Management</h2>
                    <p class="mt-1 text-sm text-gray-500">View all meetings, reschedules, and manage meeting schedules.</p>
                </div>
                
                <!-- Meeting Filters -->
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <div class="flex flex-wrap gap-4 items-center">
                        <div>
                            <label for="meeting-status-filter" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="meeting-status-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                                <option value="all">All Meetings</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="completed">Completed</option>
                                <option value="canceled">Canceled</option>
                            </select>
                        </div>
                        <div>
                            <label for="reschedule-filter" class="block text-sm font-medium text-gray-700 mb-1">Reschedule Status</label>
                            <select id="reschedule-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                                <option value="all">All</option>
                                <option value="rescheduled">Rescheduled Only</option>
                                <option value="original">Original Only</option>
                            </select>
                        </div>
                        <div>
                            <button id="refresh-meetings" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-600 transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Meetings List -->
                <div class="bg-white rounded-lg shadow-md">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">All Meetings</h3>
                        <p class="text-sm text-gray-500 mt-1">Complete overview of all scheduled meetings and their status</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Meeting ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volunteer</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Scheduled Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reschedule Info</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="meetings-list" class="bg-white divide-y divide-gray-200">
                                <!-- Meeting rows will be inserted here -->
                                <tr>
                                    <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">
                                        Loading meetings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 max-w-md mx-auto">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Confirm Deletion</h3>
            <p class="text-sm text-gray-500 mb-4">Are you sure you want to delete all students? This action cannot be undone.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    Cancel
                </button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Delete All
                </button>
            </div>
        </div>
    </div>
    
    <!-- Edit Student Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 max-w-md mx-auto w-full">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Student</h3>
            <form id="edit-student-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label for="edit-firstName" class="block text-sm font-medium text-gray-700">First Name *</label>
                        <input type="text" id="edit-firstName" name="firstName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="edit-lastName" class="block text-sm font-medium text-gray-700">Last Name *</label>
                        <input type="text" id="edit-lastName" name="lastName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                </div>
                <div>
                    <label for="edit-admissionNumber" class="block text-sm font-medium text-gray-700">Admission Number *</label>
                    <div class="flex">
                        <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">ADM</span>
                        <input type="text" id="edit-admissionNumber" name="admissionNumber" required pattern="\d{4}" maxlength="4" title="Enter exactly 4 digits" class="mt-0 block w-full border border-gray-300 rounded-r-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">Enter exactly 4 digits (e.g., 0002)</p>
                </div>
                <div>
                    <label for="edit-age" class="block text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="edit-age" name="age" min="1" max="100" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                </div>
                <div>
                    <label for="edit-gender" class="block text-sm font-medium text-gray-700">Gender</label>
                    <select id="edit-gender" name="gender" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="edit-bio" class="block text-sm font-medium text-gray-700">Bio</label>
                    <textarea id="edit-bio" name="bio" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm"></textarea>
                    <p class="mt-1 text-xs text-gray-500">Brief description of the student (1-2 sentences)</p>
                </div>
                <div>
                    <label for="edit-story" class="block text-sm font-medium text-gray-700">Student Story</label>
                    <textarea id="edit-story" name="story" rows="5" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm"></textarea>
                    <p class="mt-1 text-xs text-gray-500">Detailed background story about the student</p>
                </div>
                <div>
                    <label for="edit-profileImage" class="block text-sm font-medium text-gray-700">Profile Picture URL</label>
                    <input type="url" id="edit-profileImage" name="profileImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="https://example.com/image.jpg">
                    <p class="mt-1 text-xs text-gray-500">Direct link to student's profile picture</p>
                </div>
                <div>
                    <label for="edit-gallery" class="block text-sm font-medium text-gray-700">Gallery URLs</label>
                    <textarea id="edit-gallery" name="gallery" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="https://example.com/image1.jpg\nhttps://example.com/image2.jpg"></textarea>
                    <p class="mt-1 text-xs text-gray-500">Enter one image URL per line</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-edit" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 btn-primary text-white rounded-md hover:opacity-90 focus:outline-none">
                        Save Changes
                    </button>
                </div>
            </form>
            <div id="edit-form-message" class="mt-4 text-sm hidden"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize admin authentication
            window.TalkTimeAuth = new TalkTimeJWTAuth('admin');
            
            // Check authentication on page load
            checkAdminAuth();
            
            // Add token validation check
            function validateToken() {
                const token = window.TalkTimeAuth.getToken();
                if (!token) {
                    console.log('No token found, redirecting to login');
                    window.location.href = '/admin/login.html';
                    return false;
                }
                
                // Test token validity with a simple API call
                return window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/admin/me', {
                    method: 'GET'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Token validation failed: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('✅ Token validation successful:', data);
                    return true;
                })
                .catch(error => {
                    console.error('❌ Token validation failed:', error);
                    // Clear invalid tokens
                    window.TalkTimeAuth.logout();
                    showNotification('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        window.location.href = '/admin/login.html';
                    }, 2000);
                    return false;
                });
            }
            
            // Load students on page load
            loadStudents();
            
            // Add event listeners
            document.getElementById('add-student-form').addEventListener('submit', createStudent);
            document.getElementById('edit-student-form').addEventListener('submit', updateStudent);
            document.getElementById('refresh-students').addEventListener('click', loadStudents);
            document.getElementById('delete-all-students').addEventListener('click', showDeleteModal);
            document.getElementById('cancel-delete').addEventListener('click', hideDeleteModal);
            document.getElementById('cancel-edit').addEventListener('click', hideEditModal);
            document.getElementById('confirm-delete').addEventListener('click', deleteAllStudents);
            document.getElementById('logout-btn').addEventListener('click', logout);
        });

        // Authentication check
        function checkAdminAuth() {
            window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/jwt-auth/verify', {
                method: 'GET'
            })
            .then(response => {
                if (!response.ok) {
                    // Redirect to login if not authenticated as admin
                    window.location.href = '/admin/login.html';
                    return;
                }
                return response.json();
            })
            .then(data => {
                // Check if user is authenticated and has admin role
                if (!data.success || !data.authenticated || data.user.role !== 'admin') {
                    window.location.href = '/admin/login.html';
                    return;
                }
                console.log('✅ Admin authentication verified:', data);
            })
            .catch(error => {
                console.error('Auth check error:', error);
                window.location.href = '/admin/login.html';
            });
        }

        // Load all students
        function loadStudents() {
            window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/admin/students', {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch students');
                }
                return response.json();
            })
            .then(data => {
                const studentList = document.getElementById('student-list');
                
                if (data.students && data.students.length > 0) {
                    studentList.innerHTML = '';
                    
                    data.students.forEach(student => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.id}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.fullName}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.admissionNumber}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.age || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.gender || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button class="text-blue-600 hover:text-blue-900 mr-2" onclick="viewStudent(${student.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-indigo-600 hover:text-indigo-900 mr-2" onclick="editStudent(${student.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-900" onclick="deleteStudent(${student.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        studentList.appendChild(row);
                    });
                } else {
                    studentList.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                                No students found. Add a new student to get started.
                            </td>
                        </tr>
                    `;
                }
            })
            .catch(error => {
                console.error('Error loading students:', error);
                document.getElementById('student-list').innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-sm text-red-500">
                            Error loading students. Please try again.
                        </td>
                    </tr>
                `;
            });
        }

        // View student details (placeholder)
        function viewStudent(id) {
            window.showNotification(`Viewing student with ID: ${id}`, 'info', {
                title: 'Student Details',
                autoClose: true,
                duration: 3000
            });
            // Implement view functionality
        }

        // Delete a student
        async function deleteStudent(id) {
            // Use professional modal instead of browser confirm
            const confirmed = await window.showConfirmation(
                'Are you sure you want to delete this student? This action cannot be undone.',
                {
                    title: 'Delete Student',
                    confirmText: 'Delete',
                    cancelText: 'Cancel',
                    type: 'warning'
                }
            );
            
            if (confirmed) {
                // First, try to delete any past/cancelled meetings for this student
                window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/reset-student-meetings/${id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: 'delete_past_meetings' })
                })
                .then(response => {
                    // Now try to delete the student
                    return window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/students/${id}`, {
                        method: 'DELETE'
                    });
                })
                .then(response => {
                    if (response.ok) {
                        loadStudents();
                        return;
                    }
                    
                    // Handle specific error cases
                    return response.json()
                        .then(async (data) => {
                            if (data.error && data.error.includes('meetings')) {
                                const deleteMeetings = await window.showConfirmation(
                                    'This student has scheduled future meetings. Would you like to delete these meetings and then delete the student?',
                                    {
                                        title: 'Delete Student with Meetings',
                                        confirmText: 'Delete All',
                                        cancelText: 'Cancel',
                                        type: 'warning'
                                    }
                                );
                                
                                if (deleteMeetings) {
                                    // Delete all meetings for this student first
                                    return window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/reset-student-meetings/${id}`, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({ action: 'delete_all_meetings' })
                                    })
                                    .then(response => {
                                        if (response.ok) {
                                            // Now try to delete the student again
                                            return window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/students/${id}`, {
                                                method: 'DELETE'
                                            });
                                        }
                                        throw new Error('Failed to delete meetings');
                                    })
                                    .then(response => {
                                        if (response.ok) {
                                            loadStudents();
                                        } else {
                                            window.showNotification('Failed to delete student after deleting meetings.', 'error', {
                                                title: 'Deletion Failed',
                                                autoClose: false
                                            });
                                        }
                                    });
                                }
                            } else {
                                window.showNotification('Failed to delete student: ' + (data.error || 'Unknown error'), 'error', {
                                    title: 'Deletion Failed',
                                    autoClose: false
                                });
                            }
                        })
                        .catch(err => {
                            console.error('Error parsing response:', err);
                            window.showNotification('Failed to delete student. Please try again later.', 'error', {
                                title: 'Deletion Failed',
                                autoClose: false
                            });
                        });
                })
                .catch(error => {
                    console.error('Delete request failed:', error);
                    window.showNotification('Network error while trying to delete student. Please check your connection and try again.', 'error', {
                        title: 'Network Error',
                        autoClose: false
                    });
                });
            }
        }

        // Show delete confirmation modal
        function showDeleteModal() {
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        // Hide delete confirmation modal
        function hideDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
        }
        
        // Hide edit student modal
        function hideEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }
        
        // Edit student
        function editStudent(id) {
            // Fetch student details
            window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/students/${id}`, {
                method: 'GET'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                // Handle both direct student data and wrapped response
                const student = data.student || data;
                
                if (!student || !student.id) {
                    throw new Error('Invalid student data received from server');
                }
                
                // Populate form fields
                document.getElementById('edit-id').value = student.id;
                
                // Split fullName into firstName and lastName since backend only returns fullName
                const nameParts = (student.fullName || '').split(' ');
                const firstName = nameParts[0] || '';
                const lastName = nameParts.slice(1).join(' ') || '';
                
                document.getElementById('edit-firstName').value = firstName;
                document.getElementById('edit-lastName').value = lastName;
                
                // Extract the 4-digit part from the admission number - handle undefined safely
                if (student.admissionNumber) {
                    const admissionMatch = student.admissionNumber.match(/ADM(\d{4})/i);
                    if (admissionMatch && admissionMatch[1]) {
                        document.getElementById('edit-admissionNumber').value = admissionMatch[1];
                    } else {
                        // Try to extract just the numeric part if no ADM prefix
                        const numericMatch = student.admissionNumber.match(/(\d{4})/);
                        document.getElementById('edit-admissionNumber').value = numericMatch ? numericMatch[1] : '';
                    }
                } else {
                    document.getElementById('edit-admissionNumber').value = '';
                }
                
                document.getElementById('edit-age').value = student.age || '';
                document.getElementById('edit-gender').value = student.gender || '';
                document.getElementById('edit-bio').value = student.bio || '';
                document.getElementById('edit-story').value = student.story || '';
                document.getElementById('edit-profileImage').value = student.profileImage || student.photoUrl || '';
                
                // Format gallery array as newline-separated URLs
                if (student.gallery && Array.isArray(student.gallery)) {
                    document.getElementById('edit-gallery').value = student.gallery.join('\n');
                } else {
                    document.getElementById('edit-gallery').value = '';
                }
                
                // Show edit modal
                document.getElementById('edit-modal').classList.remove('hidden');
            })
            .catch(error => {
                console.error('Error fetching student:', error);
                
                // Show user-friendly error modal
                let errorMessage = 'Failed to load student details. Please try again.';
                
                if (error.message.includes('401') || error.message.includes('403')) {
                    errorMessage = 'Authentication expired. Please log in again.';
                    // Redirect to login after showing error
                    setTimeout(() => {
                        window.location.href = '/admin/login.html';
                    }, 2000);
                } else if (error.message.includes('404')) {
                    errorMessage = 'Student not found. The student may have been deleted.';
                } else if (error.message.includes('500')) {
                    errorMessage = 'Server error occurred. Please try again later.';
                }
                
                showNotification(errorMessage, 'error');
            });
        }

        // Update student
        function updateStudent(event) {
            event.preventDefault();
            
            const id = document.getElementById('edit-id').value;
            const firstName = document.getElementById('edit-firstName').value;
            const lastName = document.getElementById('edit-lastName').value;
            const admissionNumberDigits = document.getElementById('edit-admissionNumber').value;
            const age = document.getElementById('edit-age').value;
            const gender = document.getElementById('edit-gender').value;
            const bio = document.getElementById('edit-bio').value;
            const story = document.getElementById('edit-story').value;
            const profileImage = document.getElementById('edit-profileImage').value;
            const galleryText = document.getElementById('edit-gallery').value;
            
            // Validate required fields
            if (!firstName || !lastName || !admissionNumberDigits) {
                const messageEl = document.getElementById('edit-form-message');
                messageEl.textContent = 'First name, last name, and admission number are required';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
                return;
            }
            
            // Validate admission number format (4 digits only)
            const digitFormat = /^\d{4}$/;
            if (!digitFormat.test(admissionNumberDigits)) {
                const messageEl = document.getElementById('edit-form-message');
                messageEl.textContent = 'Admission number must be exactly 4 digits';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
                return;
            }
            
            // Construct full name and complete admission number
            // Construct full name and complete admission number
            // Construct full name and complete admission number
            const fullName = `${firstName} ${lastName}`;
            // Zero-pad the admission number to ensure it's exactly 4 digits
            const paddedDigits = admissionNumberDigits.padStart(4, '0');
            const admissionNumber = `ADM${paddedDigits}-${firstName.toLowerCase()}-${lastName.toLowerCase()}`;  
            
            // Process gallery URLs into an array
            let gallery = null;
            if (galleryText) {
                gallery = galleryText.split('\n')
                    .map(url => url.trim())
                    .filter(url => url.length > 0);
                if (gallery.length === 0) {
                    gallery = null;
                }
            }
            
            window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/admin/students/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    firstName,
                    lastName,
                    admissionNumber,
                    age: age || null,
                    gender: gender || '',
                    bio: bio || '',
                    story: story || null,
                    photoUrl: profileImage || null,
                    gallery
                })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || 'Failed to update student');
                    });
                }
                return response.json();
            })
            .then(data => {
                // Show success message
                const messageEl = document.getElementById('edit-form-message');
                messageEl.textContent = 'Student updated successfully!';
                messageEl.classList.remove('text-red-500', 'hidden');
                messageEl.classList.add('text-green-500');
                
                // Reload the student list
                loadStudents();
                
                // Hide the modal after a delay
                setTimeout(() => {
                    hideEditModal();
                    document.getElementById('edit-form-message').classList.add('hidden');
                }, 2000);
            })
            .catch(error => {
                console.error('Error updating student:', error);
                const messageEl = document.getElementById('edit-form-message');
                messageEl.textContent = error.message || 'An error occurred. Please try again.';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
            });
        }

        // Delete all students
        function deleteAllStudents() {
            window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/admin/students', {
                method: 'DELETE'
            })
            .then(response => {
                hideDeleteModal();
                
                if (response.ok) {
                    loadStudents();
                    window.showNotification('All students have been deleted successfully', 'success', {
                        title: 'Deletion Complete',
                        autoClose: true,
                        duration: 4000
                    });
                } else {
                    window.showNotification('Failed to delete all students', 'error', {
                        title: 'Deletion Failed',
                        autoClose: false
                    });
                }
            })
            .catch(error => {
                console.error('Error deleting all students:', error);
                hideDeleteModal();
                window.showNotification('An error occurred while deleting all students', 'error', {
                    title: 'Error',
                    autoClose: false
                });
            });
        }

        // Create student function
        function createStudent(event) {
            event.preventDefault();
            
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const admissionNumberDigits = document.getElementById('admissionNumber').value.trim();
            const age = document.getElementById('age').value.trim();
            const gender = document.getElementById('gender').value;
            const bio = document.getElementById('bio').value.trim();
            const story = document.getElementById('story').value.trim();
            const profileImage = document.getElementById('profileImage').value.trim();
            const galleryText = document.getElementById('gallery').value.trim();
            
            // Validate required fields
            if (!firstName || !lastName || !admissionNumberDigits) {
                const messageEl = document.getElementById('form-message');
                messageEl.textContent = 'First name, last name, and admission number are required';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
                return;
            }
            
            // Validate admission number format (4 digits only)
            const digitFormat = /^\d{4}$/;
            if (!digitFormat.test(admissionNumberDigits)) {
                const messageEl = document.getElementById('form-message');
                messageEl.textContent = 'Admission number must be exactly 4 digits';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
                return;
            }
            
            // Construct full name and complete admission number
            const fullName = `${firstName} ${lastName}`;
            const admissionNumber = `ADM${admissionNumberDigits}-${firstName.toLowerCase()}-${lastName.toLowerCase()}`;
            
            // Process gallery URLs into an array
            let gallery = null;
            if (galleryText) {
                gallery = galleryText.split('\n')
                    .map(url => url.trim())
                    .filter(url => url.length > 0);
                if (gallery.length === 0) {
                    gallery = null;
                }
            }
            
            window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/admin/students', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    firstName,
                    lastName,
                    admissionNumber,
                    age: age || null,
                    gender: gender || '',
                    bio: bio || '',
                    story: story || null,
                    photoUrl: profileImage || null,
                    gallery
                })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || 'Failed to create student');
                    });
                }
                return response.json();
            })
            .then(data => {
                // Show success message
                const messageEl = document.getElementById('form-message');
                messageEl.textContent = 'Student created successfully!';
                messageEl.classList.remove('text-red-500', 'hidden');
                messageEl.classList.add('text-green-500');
                
                // Reset form
                document.getElementById('add-student-form').reset();
                
                // Reload the student list
                loadStudents();
            })
            .catch(error => {
                console.error('Error creating student:', error);
                const messageEl = document.getElementById('form-message');
                messageEl.textContent = error.message || 'An error occurred. Please try again.';
                messageEl.classList.remove('text-green-500', 'hidden');
                messageEl.classList.add('text-red-500');
            });
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'border-pink-500', 'text-pink-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            
            // Add active class to selected tab button
            const activeButton = document.getElementById(`${tabName}-tab`);
            activeButton.classList.add('active', 'border-pink-500', 'text-pink-600');
            activeButton.classList.remove('border-transparent', 'text-gray-500');
            
            // Load data for the selected tab
            if (tabName === 'meetings') {
                loadMeetings();
            }
        }
        
        // Load meetings data
        async function loadMeetings() {
            try {
                const response = await window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/admin/meetings', {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayMeetings(data.meetings || []);
                } else {
                    console.error('Failed to load meetings:', response.status);
                    displayMeetingsError('Failed to load meetings');
                }
            } catch (error) {
                console.error('Error loading meetings:', error);
                displayMeetingsError('Network error loading meetings');
            }
        }
        
        // Display meetings in the table
        function displayMeetings(meetings) {
            const meetingsList = document.getElementById('meetings-list');
            
            if (!meetings || meetings.length === 0) {
                meetingsList.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">
                            No meetings found
                        </td>
                    </tr>
                `;
                return;
            }
            
            const meetingsHtml = meetings.map(meeting => {
                const scheduledDate = new Date(meeting.scheduled_time);
                const formattedDate = scheduledDate.toLocaleDateString();
                const formattedTime = scheduledDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // Reschedule information
                const isRescheduled = meeting.is_rescheduled;
                const rescheduleCount = meeting.reschedule_count || 0;
                const lastRescheduledAt = meeting.last_rescheduled_at;
                
                let rescheduleInfo = '';
                if (isRescheduled) {
                    const rescheduleDate = new Date(lastRescheduledAt);
                    const rescheduleFormatted = rescheduleDate.toLocaleDateString();
                    
                    let originalTimeInfo = '';
                    if (meeting.original_scheduled_time) {
                        const originalDate = new Date(meeting.original_scheduled_time);
                        const originalFormatted = originalDate.toLocaleDateString();
                        const originalTime = originalDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        originalTimeInfo = `<div class="text-xs text-gray-500 mt-1">Originally: ${originalFormatted} at ${originalTime}</div>`;
                    }
                    
                    rescheduleInfo = `
                        <div class="text-xs">
                            <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full">
                                <i class="fas fa-sync-alt mr-1"></i>Rescheduled ${rescheduleCount}x
                            </span>
                            <div class="text-gray-600 mt-1">Last: ${rescheduleFormatted}</div>
                            ${meeting.rescheduled_by_name ? `<div class="text-blue-600 mt-1"><i class="fas fa-user mr-1"></i>By: ${meeting.rescheduled_by_name}</div>` : ''}
                            ${originalTimeInfo}
                        </div>
                    `;
                } else {
                    rescheduleInfo = '<span class="text-gray-400 text-xs"><i class="fas fa-calendar-check mr-1"></i>Original</span>';
                }
                
                // Status styling
                let statusClass = 'bg-gray-100 text-gray-800';
                if (meeting.status === 'scheduled') statusClass = 'bg-blue-100 text-blue-800';
                else if (meeting.status === 'completed') statusClass = 'bg-green-100 text-green-800';
                else if (meeting.status === 'canceled') statusClass = 'bg-red-100 text-red-800';
                
                return `
                    <tr class="${isRescheduled ? 'bg-orange-25' : ''}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            #${meeting.id}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-medium">${meeting.student_name || 'Unknown Student'}</div>
                            <div class="text-xs text-gray-500">${meeting.student_admission || ''}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-medium">${meeting.volunteer_name || 'Unknown Volunteer'}</div>
                            <div class="text-xs text-gray-500">${meeting.volunteer_email || ''}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-medium">${formattedDate}</div>
                            <div class="text-xs text-gray-500">${formattedTime}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                                ${meeting.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            ${rescheduleInfo}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="viewMeetingDetails(${meeting.id})" class="text-blue-600 hover:text-blue-900 text-xs">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                ${meeting.status === 'scheduled' ? `
                                    <button onclick="cancelMeeting(${meeting.id})" class="text-red-600 hover:text-red-900 text-xs">
                                        <i class="fas fa-times mr-1"></i>Cancel
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            meetingsList.innerHTML = meetingsHtml;
        }
        
        // Display meetings error
        function displayMeetingsError(message) {
            const meetingsList = document.getElementById('meetings-list');
            meetingsList.innerHTML = `
                <tr>
                    <td colspan="7" class="px-6 py-4 text-center text-sm text-red-500">
                        <i class="fas fa-exclamation-triangle mr-2"></i>${message}
                    </td>
                </tr>
            `;
        }
        
        // View meeting details (placeholder)
        function viewMeetingDetails(meetingId) {
            // TODO: Implement meeting details modal
            alert(`View details for meeting #${meetingId}`);
        }
        
        // Cancel meeting (placeholder)
        async function cancelMeeting(meetingId) {
            if (confirm('Are you sure you want to cancel this meeting?')) {
                try {
                    const response = await window.TalkTimeAuth.makeAuthenticatedRequest(`/api/v1/meetings/${meetingId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'canceled' })
                    });
                    
                    if (response.ok) {
                        loadMeetings(); // Refresh the meetings list
                    } else {
                        alert('Failed to cancel meeting');
                    }
                } catch (error) {
                    console.error('Error canceling meeting:', error);
                    alert('Error canceling meeting');
                }
            }
        }
        
        // Add event listeners for meeting filters
        document.addEventListener('DOMContentLoaded', function() {
            // Meeting status filter
            document.getElementById('meeting-status-filter')?.addEventListener('change', function() {
                // TODO: Implement filtering logic
                loadMeetings();
            });
            
            // Reschedule filter
            document.getElementById('reschedule-filter')?.addEventListener('change', function() {
                // TODO: Implement filtering logic
                loadMeetings();
            });
            
            // Refresh button
            document.getElementById('refresh-meetings')?.addEventListener('click', function() {
                loadMeetings();
            });
        });
        
        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuToggle && mobileMenu) {
                mobileMenuToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Profile dropdown
            const profileBtn = document.getElementById('profile-btn');
            const profileDropdown = document.getElementById('profile-dropdown');
            
            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    profileDropdown.classList.toggle('show');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                        profileDropdown.classList.remove('show');
                    }
                });
            }
            
            // Logout event listeners
            const logoutLink = document.getElementById('logout-link');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
            
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
            
            if (mobileLogoutBtn) {
                mobileLogoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
        });
        
        // Logout function
        function logout() {
            window.TalkTimeAuth.makeAuthenticatedRequest('/api/v1/jwt-auth/logout', {
                method: 'POST'
            })
            .then(() => {
                window.TalkTimeAuth.clearAuth();
                window.location.href = '/admin/login.html';
            })
            .catch(error => {
                console.error('Logout error:', error);
                window.TalkTimeAuth.clearAuth();
                window.location.href = '/admin/login.html';
            });
        }
    </script>
</body>
</html>
